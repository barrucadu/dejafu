# Set-up
sudo: false

language: c

# If something is tagged, it's come from a PR which has been merged
# into master.  There's no need to build both the tag and the merge
# commit.
if: tag IS blank

# Cache builds
cache:
  directories:
  - $HOME/.ghc
  - $HOME/.cabal
  - $HOME/.stack

addons:
  apt:
    packages:
    - libgmp-dev

matrix:
  fast_finish: true
  allow_failures:
  - env: MODE=test RESOLVER=nightly

env:
  secure: lpaUGUVI96HQ3Q++n8BHAbKE1l4U3g4NR4V40CCQYj0+RNHbdMmoKNA5kI65j6yFxVmLNdYp4NRRayyqb9UHrAVRCQiBnd94Mv4id6/M13JzF7UNCsUP0lbcNj86Zlce0lwUdnIWVS6OG0PHWQEPSUu0Hs5tPixfK7A0QXC01Cs=

script: ./.travis/$MODE

jobs:
  include:
  - stage: check
    env: MODE=doctest
  - env: MODE=lint

  - stage: test
    env: MODE=test RESOLVER=lts-9.0            # GHC 8.0
  - env: MODE=test RESOLVER=lts-10.0           # GHC 8.2
  - env: MODE=test RESOLVER=nightly-2018-03-23 # GHC 8.4
  - env: MODE=test RESOLVER=nightly

  - stage: predeploy
    if: branch=master
    env: MODE=predeploy

  - stage: deploy
    if: branch=master AND type != pull_request
    env: MODE=deploy
